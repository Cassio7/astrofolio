---
import ArticleItem from "@/components/article-item.astro";
import PageLayout from "@/layouts/page-layout.astro";

import { getCollection } from "astro:content";
import { ArrowRight } from "lucide-react";

import { capitalizeFirstLetter } from "@/lib/utils";
import { SITE } from "@/lib/config";
import type { GetStaticPaths } from "astro";
import Pagination from "@/components/pagination.astro";

const articles = await getCollection("blog");
const categories = [...new Set(articles.map(article => article.data.category))];
const series = [
  ...new Set(
    articles
      .map(article => article.data.series)
      .filter(series => series !== undefined)
  ),
];

export const getStaticPaths = (async ({ paginate }) => {
  const articles = await getCollection("blog", ({ data }) => !data.draft);
  return paginate(articles, { pageSize: SITE.postPerPage });
}) satisfies GetStaticPaths;

const { page } = Astro.props;

// Page properties
const title = "Articles";
const description = `
      I talk about frontend, backend, fullstack, productivity and just what ever
      i encouter and learn in my journey as a software engineer
    `;
---

<PageLayout title={title} description={description}>
  <section class="space-y-3">
    <h3 class="text-xl font-semibold">Series</h3>
    <ul class="flex flex-wrap items-center justify-start gap-1">
      {
        series.map(seriesItem => (
          <a
            href={`/articles/series/${seriesItem}`}
            class="group flex items-center gap-x-2 rounded-sm px-2 py-1 underline decoration-muted-foreground underline-offset-4 duration-150 hover:bg-secondary"
          >
            <li>#{capitalizeFirstLetter(seriesItem)}</li>
            <ArrowRight className="scale-0 duration-75 size-4 group-hover:scale-100" />
          </a>
        ))
      }
    </ul>
  </section>

  <section class="space-y-3">
    <h3 class="text-xl font-semibold">Categories</h3>
    <ul class="flex flex-wrap items-center justify-start gap-1">
      {
        categories.map(category => (
          <a
            href={`/articles/categories/${category}`}
            class="group flex items-center gap-x-2 rounded-sm px-2 py-1 underline decoration-muted-foreground underline-offset-4 duration-150 hover:bg-secondary"
          >
            <li>#{capitalizeFirstLetter(category)}</li>
            <ArrowRight className="scale-0 duration-75 size-4 group-hover:scale-100" />
          </a>
        ))
      }
    </ul>
  </section>

  <section class="space-y-3">
    <h3 class="text-xl font-semibold">Articles</h3>
    <ul class="flex w-full flex-col items-start justify-start gap-8">
      {page.data.map(article => <ArticleItem article={article} />)}
    </ul>

    <Pagination page={page} />
  </section>
</PageLayout>
